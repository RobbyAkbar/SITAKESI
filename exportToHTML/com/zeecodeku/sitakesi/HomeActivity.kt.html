<html>
<head>
<title>HomeActivity.kt</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #629755; font-style: italic;}
.s5 { color: #629755; font-weight: bold; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
HomeActivity.kt</font>
</center></td></tr></table>
<pre><span class="s0">package </span><span class="s1">com.zeecodeku.sitakesi</span>

import android.content.Context
import android.content.Intent
import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import androidx.core.text.HtmlCompat
import androidx.appcompat.app.AlertDialog
import androidx.appcompat.widget.AppCompatTextView
import androidx.recyclerview.widget.LinearLayoutManager
import androidx.recyclerview.widget.RecyclerView
import androidx.appcompat.widget.Toolbar
import android.util.Log
import android.view.Menu
import android.view.MenuItem
import android.view.View
import android.view.animation.Animation
import android.view.animation.AnimationUtils
import android.widget.ProgressBar
import android.widget.Toast
import com.android.volley.Response
import com.android.volley.toolbox.StringRequest
import com.android.volley.toolbox.Volley
import com.zeecodeku.sitakesi.adapters.OrganisasiAdapter
import com.zeecodeku.sitakesi.helpers.InputValidation
import com.zeecodeku.sitakesi.models.OrganisasiModel
import com.zeecodeku.sitakesi.parsing.OrganisasiJSONParser
import com.zeecodeku.sitakesi.utils.AppUtils
import com.zeecodeku.sitakesi.utils.Config
import android.content.pm.PackageManager
import android.net.Uri
import androidx.coordinatorlayout.widget.CoordinatorLayout
import com.google.android.material.floatingactionbutton.FloatingActionButton
import com.google.android.material.snackbar.Snackbar
import com.google.android.material.textfield.TextInputEditText
import com.google.android.material.textfield.TextInputLayout

<span class="s0">class </span><span class="s1">HomeActivity : AppCompatActivity()</span><span class="s0">, </span><span class="s1">View.OnClickListener</span><span class="s0">, </span><span class="s1">OrganisasiAdapter.RecyclerViewItemClickListener {</span>

    private <span class="s0">val </span><span class="s1">activity = </span><span class="s0">this</span><span class="s1">@HomeActivity</span>

    private <span class="s0">var </span><span class="s1">isFabOpen = </span><span class="s0">false</span>

    <span class="s1">private lateinit </span><span class="s0">var </span><span class="s1">toolbar: Toolbar</span>
    private lateinit <span class="s0">var </span><span class="s1">coordinatorLayout: CoordinatorLayout</span>
    private lateinit <span class="s0">var </span><span class="s1">recyclerView: RecyclerView</span>
    private lateinit <span class="s0">var </span><span class="s1">progressBar: ProgressBar</span>
    private lateinit <span class="s0">var </span><span class="s1">organisasiAdapter: OrganisasiAdapter</span>

    private lateinit <span class="s0">var </span><span class="s1">fab: FloatingActionButton</span>
    private lateinit <span class="s0">var </span><span class="s1">fab1: FloatingActionButton</span>
    private lateinit <span class="s0">var </span><span class="s1">fab2: FloatingActionButton</span>
    private lateinit <span class="s0">var </span><span class="s1">textFab1: AppCompatTextView</span>
    private lateinit <span class="s0">var </span><span class="s1">textFab2: AppCompatTextView</span>

    private lateinit <span class="s0">var </span><span class="s1">animFabOpen: Animation</span>
    private lateinit <span class="s0">var </span><span class="s1">animFabClose: Animation</span>
    private lateinit <span class="s0">var </span><span class="s1">animRotateForward: Animation</span>
    private lateinit <span class="s0">var </span><span class="s1">animRotateBackward: Animation</span>

    private lateinit <span class="s0">var </span><span class="s1">inputValidation: InputValidation</span>

    override <span class="s0">fun </span><span class="s1">onCreate(savedInstanceState: Bundle?) {</span>
        <span class="s0">super</span><span class="s1">.onCreate(savedInstanceState)</span>

        <span class="s0">if </span><span class="s1">(AppUtils.hasUserLoggedin(</span><span class="s0">this</span><span class="s1">)) startActivity(Intent(</span><span class="s0">this, </span><span class="s1">SplashActivity::</span><span class="s0">class</span><span class="s1">.java))</span>

        setContentView(R.layout.activity_home)

        <span class="s0">if </span><span class="s1">(!AppUtils.hasUserLoggedin(</span><span class="s0">this</span><span class="s1">)) {</span>
            startActivity(Intent(<span class="s0">this, </span><span class="s1">LoginActivity::</span><span class="s0">class</span><span class="s1">.java))</span>
            finish()
        }

        <span class="s0">if </span><span class="s1">(!AppUtils.hasUserSeenOnboarding(</span><span class="s0">this</span><span class="s1">)) {</span>
            startActivity(Intent(<span class="s0">this, </span><span class="s1">OnboardingActivity::</span><span class="s0">class</span><span class="s1">.java))</span>
            finish()
        }

        <span class="s2">// initializing the views</span>
        <span class="s1">initViews()</span>

        organisasiAdapter = OrganisasiAdapter(<span class="s0">this</span><span class="s1">)</span>
        recyclerView.layoutManager = LinearLayoutManager(activity)
        recyclerView.adapter = organisasiAdapter

        <span class="s2">// initializing the listeners</span>
        <span class="s1">initListeners()</span>

        <span class="s2">// initializing the objects</span>
        <span class="s1">initObjects()</span>

        toolbar.title = getString(R.string.hello)+<span class="s3">&quot; &quot;</span><span class="s1">+AppUtils.getName(activity)</span>
        setSupportActionBar(toolbar)

        <span class="s0">if </span><span class="s1">(AppUtils.getOrganisasi(activity) != </span><span class="s3">&quot;&quot;</span><span class="s1">) setRecyclerView(AppUtils.getOrganisasi(activity)!!)</span>
        <span class="s0">if </span><span class="s1">(AppUtils.isNetworkStatusAvialable(activity)) getDataOnline()</span>
    }

    private <span class="s0">fun </span><span class="s1">getDataOnline() {</span>
        progressBar.visibility = View.VISIBLE
        <span class="s0">val </span><span class="s1">idAnggota = AppUtils.getIdAnggota(activity)!!</span>
        <span class="s0">val </span><span class="s1">queue = Volley.newRequestQueue(</span><span class="s0">this</span><span class="s1">)</span>
        <span class="s0">val </span><span class="s1">stringRequest = </span><span class="s0">object </span><span class="s1">: StringRequest(Method.POST</span><span class="s0">, </span><span class="s1">Config.CHECK_ORGANIZATION_URL</span><span class="s0">,</span>
            <span class="s1">Response.Listener&lt;String&gt; { response -&gt;</span>
                <span class="s0">if </span><span class="s1">(response.contains(Config.FAILURE)){</span>
                    Snackbar.make(coordinatorLayout<span class="s0">, </span><span class="s1">getString(R.string.message_no_organization)</span><span class="s0">, </span><span class="s1">Snackbar.LENGTH_LONG)</span>
                        .setAction(getString(R.string.ok)) {
                            animateFAB()
                        }.show()
                } <span class="s0">else </span><span class="s1">{</span>
                    setRecyclerView(response)
                    <span class="s0">val </span><span class="s1">sharedPreferences =</span>
                        activity.getSharedPreferences(Config.SHARED_PREF_NAME<span class="s0">, </span><span class="s1">Context.MODE_PRIVATE)</span>
                    <span class="s0">val </span><span class="s1">editor = sharedPreferences.edit()</span>
                    editor.putString(Config.GROUPJSON_SHARED_PREF<span class="s0">, </span><span class="s1">response)</span>
                    editor.apply()
                    editor.commit()
                }
                progressBar.visibility = View.INVISIBLE
            }<span class="s0">,</span>
            <span class="s1">Response.ErrorListener {</span>
                progressBar.visibility = View.INVISIBLE
                Toast.makeText(activity<span class="s0">, </span><span class="s1">getString(R.string.connection_failed)</span><span class="s0">, </span><span class="s1">Toast.LENGTH_SHORT).show()</span>
            }){
            override <span class="s0">fun </span><span class="s1">getParams(): Map&lt;String</span><span class="s0">, </span><span class="s1">String&gt; {</span>
                <span class="s0">val </span><span class="s1">params = HashMap&lt;String</span><span class="s0">, </span><span class="s1">String&gt;()</span>
                params[Config.ID_ANGGOTA_SHARED_PREF] = idAnggota
                <span class="s0">return </span><span class="s1">params</span>
            }
        }
        queue.add(stringRequest)
    }

    private <span class="s0">fun </span><span class="s1">setRecyclerView(response: String){</span>
        <span class="s0">val </span><span class="s1">groupList: List&lt;OrganisasiModel&gt; = OrganisasiJSONParser.parseData(response)</span>
        organisasiAdapter.updateWith(groupList)
    }

    override <span class="s0">fun </span><span class="s1">clickOnItem(data: OrganisasiModel) {</span>
        <span class="s0">val </span><span class="s1">intentOrganization = Intent(activity</span><span class="s0">, </span><span class="s1">OrganizationActivity::</span><span class="s0">class</span><span class="s1">.java)</span>
        intentOrganization.putExtra(Config.EXTRA_ORGANIZATION<span class="s0">, </span><span class="s1">data)</span>
        <span class="s0">if </span><span class="s1">(data.getStatusOrganisasi()==</span><span class="s3">&quot;aktif&quot;</span><span class="s1">)</span>
            startActivity(intentOrganization)
        <span class="s0">else </span><span class="s1">Snackbar.make(coordinatorLayout</span><span class="s0">, </span><span class="s1">getString(R.string.message_payment)</span><span class="s0">, </span><span class="s1">Snackbar.LENGTH_SHORT)</span>
            .setAction(getString(R.string.how)){
                popUpActive(data)
            }.show()
    }

    <span class="s4">/**</span>
     * This method is to initialize views
     */
    <span class="s1">private </span><span class="s0">fun </span><span class="s1">initViews() {</span>
        toolbar = findViewById&lt;View&gt;(R.id.toolbar) <span class="s0">as </span><span class="s1">Toolbar</span>
        coordinatorLayout = findViewById&lt;View&gt;(R.id.coordinator_layout) <span class="s0">as </span><span class="s1">CoordinatorLayout</span>
        fab = findViewById&lt;View&gt;(R.id.fab) <span class="s0">as </span><span class="s1">FloatingActionButton</span>
        fab1 = findViewById&lt;View&gt;(R.id.fab1) <span class="s0">as </span><span class="s1">FloatingActionButton</span>
        fab2 = findViewById&lt;View&gt;(R.id.fab2) <span class="s0">as </span><span class="s1">FloatingActionButton</span>
        textFab1 = findViewById&lt;View&gt;(R.id.textFab1) <span class="s0">as </span><span class="s1">AppCompatTextView</span>
        textFab2 = findViewById&lt;View&gt;(R.id.textFab2) <span class="s0">as </span><span class="s1">AppCompatTextView</span>
        recyclerView = findViewById(R.id.recyclerView)
        progressBar = findViewById(R.id.progressBar)
    }

    <span class="s4">/**</span>
     * This method is to initialize listeners
     */
    <span class="s1">private </span><span class="s0">fun </span><span class="s1">initListeners() {</span>
        fab.setOnClickListener(<span class="s0">this</span><span class="s1">)</span>
        fab1.setOnClickListener(<span class="s0">this</span><span class="s1">)</span>
        fab2.setOnClickListener(<span class="s0">this</span><span class="s1">)</span>
    }

    <span class="s4">/**</span>
     * This method is to initialize objects to be used
     */
    <span class="s1">private </span><span class="s0">fun </span><span class="s1">initObjects() {</span>
        animFabOpen = AnimationUtils.loadAnimation(activity<span class="s0">, </span><span class="s1">R.anim.fab_open)</span>
        animFabClose = AnimationUtils.loadAnimation(activity<span class="s0">, </span><span class="s1">R.anim.fab_close)</span>
        animRotateForward = AnimationUtils.loadAnimation(activity<span class="s0">, </span><span class="s1">R.anim.rotate_forward)</span>
        animRotateBackward = AnimationUtils.loadAnimation(activity<span class="s0">, </span><span class="s1">R.anim.rotate_backward)</span>
        inputValidation = InputValidation(activity)
    }

    <span class="s4">/**</span>
     * This implemented method is to listen the click on view
     *
     * <span class="s5">@param </span><span class="s4">v</span>
     */
    <span class="s1">override </span><span class="s0">fun </span><span class="s1">onClick(v: View) {</span>
        <span class="s0">when </span><span class="s1">(v.id) {</span>
            R.id.fab -&gt; animateFAB()
            R.id.fab1 -&gt; {
                <span class="s0">val </span><span class="s1">intentCreate = Intent(applicationContext</span><span class="s0">, </span><span class="s1">CreateOrganisasiActivity::</span><span class="s0">class</span><span class="s1">.java)</span>
                startActivityForResult(intentCreate<span class="s0">, </span><span class="s1">Config.CREATE_ACTIVITY)</span>
            }
            R.id.fab2 -&gt; popUpJoin()
        }
    }

    private <span class="s0">fun </span><span class="s1">popUpActive(data: OrganisasiModel) {</span>
        <span class="s0">val </span><span class="s1">builder = AlertDialog.Builder(</span><span class="s0">this</span><span class="s1">)</span>
        builder.setTitle(getString(R.string.how_to_active))
        builder.setMessage(HtmlCompat.fromHtml(getString(R.string.active_group)<span class="s0">, </span><span class="s1">HtmlCompat.FROM_HTML_MODE_LEGACY))</span>
        builder.setPositiveButton(android.R.string.yes) { dialog<span class="s0">, </span><span class="s1">_ -&gt;</span>
            dialog.dismiss()
        }
        builder.setNeutralButton(getString(R.string.confirm_payment)) { dialog<span class="s0">, </span><span class="s1">_ -&gt;</span>
            dialog.dismiss()
            <span class="s0">val </span><span class="s1">contact = </span><span class="s3">&quot;+6289625840513&quot; </span><span class="s2">// use country code with your phone number</span>
            <span class="s0">val </span><span class="s1">message = getString(R.string.active_message)+</span><span class="s3">&quot; &quot;</span><span class="s1">+</span><span class="s3">&quot;*</span><span class="s0">${</span><span class="s1">data.getReferral()</span><span class="s0">}</span><span class="s3">*&quot;</span>
            <span class="s0">val </span><span class="s1">url = </span><span class="s3">&quot;https://wa.me/</span><span class="s0">$</span><span class="s1">contact</span><span class="s3">/?text=</span><span class="s0">$</span><span class="s1">message</span><span class="s3">&quot;</span>
            <span class="s0">try </span><span class="s1">{</span>
                packageManager.getPackageInfo(<span class="s3">&quot;com.whatsapp&quot;</span><span class="s0">, </span><span class="s1">PackageManager.GET_ACTIVITIES)</span>
                <span class="s0">val </span><span class="s1">i = Intent(Intent.ACTION_VIEW)</span>
                i.data = Uri.parse(url)
                startActivity(i)
            } catch (e: PackageManager.NameNotFoundException) {
                Toast.makeText(activity<span class="s0">, </span><span class="s3">&quot;Whatsapp app not installed in your phone&quot;</span><span class="s0">, </span><span class="s1">Toast.LENGTH_SHORT)</span>
                    .show()
                e.printStackTrace()
            }
        }
        builder.show()
    }

    private <span class="s0">fun </span><span class="s1">popUpJoin() {</span>
        <span class="s0">val </span><span class="s1">builder = AlertDialog.Builder(</span><span class="s0">this</span><span class="s1">)</span>
        builder.setTitle(R.string.join_organization)
        <span class="s0">val </span><span class="s1">dialogLayout = View.inflate(activity</span><span class="s0">, </span><span class="s1">R.layout.search_layout</span><span class="s0">, null</span><span class="s1">)</span>
        <span class="s0">val </span><span class="s1">editText = dialogLayout.findViewById&lt;TextInputEditText&gt;(R.id.textInputEditTextOrganization)</span>
        <span class="s0">val </span><span class="s1">inputEditText = dialogLayout.findViewById&lt;TextInputLayout&gt;(R.id.textInputLayoutOrganization)</span>
        builder.setView(dialogLayout)
        builder.setPositiveButton(R.string.ok) { _<span class="s0">, </span><span class="s1">_ -&gt; }</span>
        <span class="s0">val </span><span class="s1">dialog = builder.create()</span>
        dialog.show()
        dialog.getButton(AlertDialog.BUTTON_POSITIVE).setOnClickListener {
            <span class="s0">if </span><span class="s1">(inputValidation.isInputEditTextFilled(editText</span><span class="s0">, </span><span class="s1">inputEditText</span><span class="s0">, </span><span class="s1">getString(R.string.error_message_referral))) {</span>
                dialog.dismiss()
                AppUtils.progressDialog(activity<span class="s0">, </span><span class="s1">activity.getString(R.string.searching_organization))</span>
                <span class="s0">val </span><span class="s1">referral = editText.text.toString().trim()</span>
                <span class="s0">val </span><span class="s1">idAnggota = AppUtils.getIdAnggota(activity)!!</span>
                <span class="s0">val </span><span class="s1">queue = Volley.newRequestQueue(</span><span class="s0">this</span><span class="s1">)</span>
                <span class="s0">val </span><span class="s1">stringRequest = </span><span class="s0">object </span><span class="s1">: StringRequest(Method.POST</span><span class="s0">, </span><span class="s1">Config.SEARCH_ORGANIZATION_URL</span><span class="s0">,</span>
                    <span class="s1">Response.Listener&lt;String&gt; {response -&gt;</span>
                        <span class="s0">if </span><span class="s1">(response.contains(Config.SUCCESS)) {</span>
                            getDataOnline()
                            Snackbar.make(coordinatorLayout<span class="s0">, </span><span class="s1">getString(R.string.success_join_message)</span><span class="s0">, </span><span class="s1">Snackbar.LENGTH_SHORT).show()</span>
                        } <span class="s0">else if </span><span class="s1">(response.contains(Config.FAILURE)){</span>
                            Snackbar.make(coordinatorLayout<span class="s0">, </span><span class="s1">getString(R.string.already_join_message)</span><span class="s0">, </span><span class="s1">Snackbar.LENGTH_SHORT).show()</span>
                        }
                        AppUtils.hideProgressDialog()
                    }<span class="s0">,</span>
                    <span class="s1">Response.ErrorListener {</span>
                        AppUtils.hideProgressDialog()
                        Toast.makeText(activity<span class="s0">, </span><span class="s1">getString(R.string.connection_failed)</span><span class="s0">, </span><span class="s1">Toast.LENGTH_SHORT).show()</span>
                    }){
                    override <span class="s0">fun </span><span class="s1">getParams(): Map&lt;String</span><span class="s0">, </span><span class="s1">String&gt; {</span>
                        <span class="s0">val </span><span class="s1">params = HashMap&lt;String</span><span class="s0">, </span><span class="s1">String&gt;()</span>
                        params[Config.REFERRAL_PARAM] = referral
                        params[Config.ID_ANGGOTA_SHARED_PREF] = idAnggota
                        <span class="s0">return </span><span class="s1">params</span>
                    }
                }
                queue.add(stringRequest)
            }
        }
    }

    private <span class="s0">fun </span><span class="s1">animateFAB() {</span>

        <span class="s0">if </span><span class="s1">(isFabOpen) {</span>

            fab.startAnimation(animRotateBackward)
            fab1.startAnimation(animFabClose)
            fab2.startAnimation(animFabClose)
            textFab1.startAnimation(animFabClose)
            textFab2.startAnimation(animFabClose)
            fab1.isClickable = <span class="s0">false</span>
            <span class="s1">fab2.isClickable = </span><span class="s0">false</span>
            <span class="s1">isFabOpen = </span><span class="s0">false</span>
            <span class="s1">Log.d(</span><span class="s3">&quot;fab&quot;</span><span class="s0">, </span><span class="s3">&quot;close&quot;</span><span class="s1">)</span>

        } <span class="s0">else </span><span class="s1">{</span>

            fab.startAnimation(animRotateForward)
            fab1.startAnimation(animFabOpen)
            fab2.startAnimation(animFabOpen)
            textFab1.startAnimation(animFabOpen)
            textFab2.startAnimation(animFabOpen)
            fab1.isClickable = <span class="s0">true</span>
            <span class="s1">fab2.isClickable = </span><span class="s0">true</span>
            <span class="s1">isFabOpen = </span><span class="s0">true</span>
            <span class="s1">Log.d(</span><span class="s3">&quot;fab&quot;</span><span class="s0">, </span><span class="s3">&quot;open&quot;</span><span class="s1">)</span>

        }
    }

    override <span class="s0">fun </span><span class="s1">onActivityResult(requestCode: Int</span><span class="s0">, </span><span class="s1">resultCode: Int</span><span class="s0">, </span><span class="s1">data: Intent?) {</span>
        <span class="s0">if </span><span class="s1">(requestCode == Config.CREATE_ACTIVITY) getDataOnline()</span>
        <span class="s0">super</span><span class="s1">.onActivityResult(requestCode</span><span class="s0">, </span><span class="s1">resultCode</span><span class="s0">, </span><span class="s1">data)</span>
    }

    override <span class="s0">fun </span><span class="s1">onCreateOptionsMenu(menu: Menu): Boolean {</span>
        <span class="s0">val </span><span class="s1">inflater = menuInflater</span>
        inflater.inflate(R.menu.menu_setting<span class="s0">, </span><span class="s1">menu)</span>
        <span class="s0">return super</span><span class="s1">.onCreateOptionsMenu(menu)</span>
    }

    override <span class="s0">fun </span><span class="s1">onOptionsItemSelected(item: MenuItem): Boolean {</span>
        <span class="s2">// Handle presses on the action bar menu items</span>
        <span class="s0">when </span><span class="s1">(item.itemId) {</span>
            R.id.setting -&gt; {
                <span class="s0">val </span><span class="s1">intent = Intent(activity</span><span class="s0">, </span><span class="s1">SettingActivity::</span><span class="s0">class</span><span class="s1">.java)</span>
                startActivity(intent)
                <span class="s0">return true</span>
            <span class="s1">}</span>
        }
        <span class="s0">return super</span><span class="s1">.onOptionsItemSelected(item)</span>
    }

    override <span class="s0">fun </span><span class="s1">onResume() {</span>
        <span class="s0">if </span><span class="s1">(!AppUtils.hasUserLoggedin(</span><span class="s0">this</span><span class="s1">)) {</span>
            startActivity(Intent(<span class="s0">this, </span><span class="s1">LoginActivity::</span><span class="s0">class</span><span class="s1">.java))</span>
            finish()
        }
        <span class="s0">super</span><span class="s1">.onResume()</span>
    }

}
</pre>
</body>
</html>